# 성능테스트 부하테스트 Stress테스트

안정적인 테스트 환경의 기본 -> Mock Server를 따로 운영한다. 

- MockServer : 실제 외부  시스템이나 의존성을 흉내내는 가짜 서버, 어떤 요청을 받던 항상 정해놓은 예상 결과 일관된 응답시간을 반환한다.

용어 자체에 매몰 보다는 테스트가 어떤 목적을 가지고 설계되었나 이해하는 것이 중요하다.

## Performance(성능) Test
성능 Test는 다양한 지표를 본다. 시스템의 속도, 응답 시간, Resource는 얼마나 사용하는지, Resource Utilization, Stability(안정성), Scalability까지 다양하다. 


주된 목적은 시스템의 기준 성능, Benchmark를 설정하는 것
현재 시스템이 어느정도 수준인지 객관적으로 파악하고 앞으로 성능 개선 목표를 세우거나 서비스 수준 협약(SLA) 기준을 마련하는 근거로 삼는다. 

=> 시스템 사용자에게 일관된 경험을 제공하는지 평가하는 척도

## Load(부하) Test
부하 Test는 특정 상황에 집중한다.

시스템이 처리할 으로 예상되는 최대 사용량, 그 한계치까지 부하를 점점 늘려가면서 성능을 확인하는 것
Load Test는 Performance Test의 한 종류이며, 정상적인 최대 부하 혹은 피크 타임 부하를 잘 처리할 수 있는지 검증하는데 초점을 맞춘다.

그 과정에서 발생할 수 있는 병목 지점을 찾아낸다. ex 부하가 늘어나다 특정 지점에서 갑자기 CPU 사용률이 100%가 된다거나, 메모리가 부족해진다거나 ..

이러한 부하 Test의 결과는 `SLA`를 만족시킬 수 있는지 확인하는데 사용된다. 
ex. 동시 사용자 1,000명 까지는 평균 응답 시간 2초 이하를 보장한다. 라는 `SLA`가 있다면 Load Test를 통해 실제로 1000명 동시 사용자를 시뮬레이션 했을 때 응답 시간이 정말 2초 이하로 유지되는지 검증한다.

사용되는 도구: `WAPT`, `LoadRunner`, `JMeter` 등

실제 사용 패턴과 유사한 부하를 준다.
- ex. 처음에는 사용자 100명으로 시작해서 1분마다 100명씩 늘린다. 총 1,000명에 도달한 다음에 이 상태를 한 10분정도 유지하고, 다시 점진적으로 사용자를 줄여나가는 방식.

## Stress Test

Stress Test는 의도적으로 시스템이 처리할 수 있는 용량의 한계점을 초과하는 부하를 가하는 것이다.
시스템이 비정상적인 상황에서 어떻게 동작하는지, 언제 고장나는지 
고장난 이후에는 어떻게 복구되는지 테스트

가장 중요한 점은 '시스템이 극한 상황에 처했을 대, 데이터 손실 없이 "우아하게 실패"하는가'
-  서비스가 바로 다운되는 것이 아니라, 시스템에 문제가 있다고 알리고, 진행 중이던 작업을 안전하게 저장하거나 중단 시키는 식으로 처리했는가 
- 과부하 상태가 풀렸을 때 시스템이 스스로 알아서 정상 상태로 복구(Recovery) 될 수 있는가? 

등 일반적인 부하 상황에서는 잘 드러나지 않는 심각한 문제들(동기화, RaceConditions, 메모리누수 등)을 찾는데 효과적이다.

각 테스트의 관계를 표로 정리해보면 한 눈에 비교하기 좋다.
포함 관계를 보면 성능 Test가 Load와 Stress를 모두 포함하는 상위 개념이다.

주요 목표를 통해 분류하면 다음과 같다.

| 구분              | 성능 테스트 (Performance Test)        | 부하 테스트 (Load Test)                    | 스트레스 테스트 (Stress Test)                   |
| --------------- | -------------------------------- | ------------------------------------- | ---------------------------------------- |
| **포함 관계**       | 상위 개념 (Load, Stress 포함)          | Performance 하위                        | Performance 하위                           |
| **주요 목표**       | - 전반적인 성능 지표 측정<br>- 기존 성능 기준 확립 | - 예상 최대 트래픽에서 정상 동작 검증<br>- SLA 기준 수립 | - 시스템 한계점 확인<br>- 극한 상황에서 안정성 및 복구 능력 평가 |
| **초점**          | 응답 시간, 처리량, 자원 사용률 등 성능 지표       | 최대 예상 사용자 수에서 성능 안정성                  | 임계점 이후 장애 발생 시 동작 특성                     |
| **부하 수준**       | 기준 부하 ~ 약간의 변동 포함 다양한 부하         | 예상 최대 부하까지 점진적으로 증가                   | 최대 부하 초과를 강제로 부여                         |
| **관심사**         | 시스템 성능 특성 분석                     | 성능 유지 + SLA 준수 가능성                    | 장애 시 반응, 복구 여부                           |
| **결과 관점**       | 병목 지점 및 최적화 지점 파악                | 최대 서비스 가능 범위 정의                       | 복구 절차 개선 및 탄력성 확보                        |
| **실패 상황 포함 여부** | 일반적으로 실패를 기대하지 않음                | 실패 발생 가능, 체크 필요                       | **실패가 우선적으로 발생함**                        |
| **예시 시나리오**     | TPS(초당 처리 건수) 측정                 | 대규모 이벤트 트래픽 대응 테스트                    | 순간 폭증 트래픽, 장애 발생 후 자동복구 확인               |


### 그 외 Test
그 외에도 Volume Test나 Scaleability Test등 다양한 테스트들이 완전히 독립적이라기 보다는 서로 밀접하게 연관되어 있음을 벤 다이어그램을 통해 확인 가능하다. 

- Scaleability Test :  부하에 맞춰서 확장될 수 있는지, 그 확장이 성능 향상으로 이어지는지 측정하는 테스트 
    - ex.웹 서버량을 늘렸을 때 그에 비례해서 처리량이 늘어나는가?

> 용어에 얽매이기 보다는 각각의 테스트가 어떤 궁극적인 목표를 가지고 어떤 부하 패턴을 사용하는가, 이걸 이해하는 것이 중요하다.